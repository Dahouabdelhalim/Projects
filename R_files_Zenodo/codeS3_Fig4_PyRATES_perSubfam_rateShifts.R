################################################################################
# From Balisi and Van Valkenburgh (2020) Communications Biology
# CODE FOR FIGURE 4:
## Origination and extinction rates through time with credible intervals, 
## and histograms of inferred times of rate shifts for origination and extinction 
################################################################################


## set up large multiframe plot
library(scales)
library(viridis)
trans = 0.1
par(mfrow=c(4, 3), cex.lab=2, cex.axis=1.5, mar=c(1, 5.5, 0, 0)+0.1, oma=c(5.5, 0, 0, 0))

# 95% HPDs calculated using code from Biopy (https://www.cs.auckland.ac.nz/~yhel002/biopy/)
## long lists of numbers below generated by PyRate analyses


################################################################################
# Row 1, col 1. ALL-CANID DIVERSIFICATION RATES
################################################################################

time_all = c(-0.500341421053, -1.50102426316, -2.50170710526, -3.50238994737,
             -4.50307278947, -5.50375563158, -6.50443847368, -7.50512131579,
             -8.50580415789, -9.506487, -10.5071698421, -11.5078526842, 
             -12.5085355263, -13.5092183684, -14.5099012105, -15.5105840526, 
             -16.5112668947, -17.5119497368, -18.5126325789, -19.5133154211, 
             -20.5139982632, -21.5146811053, -22.5153639474, -23.5160467895, 
             -24.5167296316, -25.5174124737, -26.5180953158, -27.5187781579, 
             -28.519461, -29.5201438421, -30.5208266842, -31.5215095263, 
             -32.5221923684, -33.5228752105, -34.5235580526, -35.5242408947, 
             -36.5249237368, -37.5256065789)

# ALL-CANID ORIGINATION RATES
rate_sp_all = c(1.10562092993, 1.10554880289, 1.00229230151, 0.495192787199,
             0.350849293064, 0.342062622624, 0.341321289116, 0.34119330688,
             0.341238641648, 0.340893133008, 0.340241472782, 0.340305793998,
             0.341265389417, 0.341790826886, 0.342115172927, 0.343246255402,
             0.345651602491, 0.345517307263, 0.345500682019, 0.347286958694,
             0.1589566511, 0.0953385986251, 0.0941892222473, 0.0946161718242,
             0.0953585971534, 0.0965978251524, 0.0990556635193, 0.101707131962,
             0.106597717142, 0.245980865616, 0.463472615719, 0.464375980024,
             0.464621174327, 0.466661605706, 0.467691714895, 0.466996321984,
             0.466323583094, 0.46608356375)
minHPD_sp_all = c(0.321565764194, 0.321588355032, 0.267015444001, 0.220340399073,
               0.192710928064, 0.210281375576, 0.225848596236, 0.228619337304,
               0.230151490188, 0.229998867838, 0.230216217254, 0.230163962923,
               0.233675185926, 0.234380722903, 0.234400726918, 0.235039865591,
               0.230227580178, 0.229698089875, 0.224209654569, 0.205929217319,
               0.0307883463442, 0.0101186286286, 0.0014096155567,
               0.00944419108755, 0.0169789542981, 0.0239606822649,
               0.0285354314108, 0.0319252755776, 0.0353582758279,
               0.0449626624783, 0.21060240541, 0.219614839491, 0.221137345238,
               0.220886336365, 0.221554017778, 0.220690878893, 0.217867327599,
               0.214002849029)
maxHPD_sp_all = c(1.8199229164, 1.81987414178, 1.63904258778, 1.48921244475,
               1.07083682067, 0.480883483022, 0.462033403794, 0.457864277489,
               0.456793214257, 0.454779379426, 0.454781575713, 0.454258202199,
               0.454075847384, 0.453647198818, 0.454716918607, 0.461230592106,
               0.476331533392, 0.480391202006, 0.484681577281, 0.549325636678,
               0.420932315892, 0.284716816326, 0.232085835898, 0.235775659708,
               0.242715939983, 0.257155898814, 0.279354541967, 0.310820985662,
               0.379831664964, 0.569622617222, 0.765491895716, 0.734183146992,
               0.73193265924, 0.734136415767, 0.740026276243, 0.744463115855,
               0.748705567802, 0.75362429945)

# ALL-CANID EXTINCTION RATES
rate_ex_all = c(0.722002269951, 0.721992813356, 0.682744017708, 0.612058478209,
                0.588537088942, 0.45133099993, 0.405397331548, 0.40081224012,
                0.397125992543, 0.396774960844, 0.39604825817, 0.39574037713,
                0.396270101707, 0.395766814332, 0.395223492263, 0.395872660478,
                0.397331491451, 0.408561206636, 0.406872164145, 0.394054729005,
                0.149030160987, 0.135811604247, 0.134847673777, 0.135068743405,
                0.13528754967, 0.135346844786, 0.135357424579, 0.135558832938,
                0.135292106223, 0.132595761707, 0.131809850752, 0.131622653624,
                0.131540044149, 0.13153716737, 0.131453060593, 0.131373741703,
                0.13134061279, 0.131361568005)
minHPD_ex_all = c(0.336094210327, 0.336089560492, 0.331445784804, 0.316343515497,
                  0.313708862868, 0.245370357668, 0.227290223386, 0.232654394064,
                  0.251453022014, 0.254335268676, 0.255115429884, 0.258010321788,
                  0.258454182463, 0.258454182463, 0.254994935705, 0.255241199513,
                  0.2542889906, 0.228947459103, 0.111853477252, 0.0973969110623,
                  0.0803006373161, 0.066408235948, 0.0720379028297,
                  0.0767647420837, 0.0785305495747, 0.0789343469264,
                  0.0798784411571, 0.0787278375523, 0.0773609776261,
                  0.0648986242393, 0.0541152332713, 0.0510373638393,
                  0.0495182945836, 0.0463663637187, 0.0441188713443,
                  0.0394469244354, 0.0381994530426, 0.0327084085329)
maxHPD_ex_all = c(1.30635033406, 1.30633819081, 1.27735369072, 1.24754466358,
                  1.26349144789, 1.12430408736, 0.687922994091, 0.569582494712,
                  0.538060687236, 0.533772654998, 0.529039829711, 0.529546819945,
                  0.527810638423, 0.529555973291, 0.529018380672, 0.529736380924,
                  0.538458675811, 0.79352949218, 0.655513782546, 0.560848194681,
                  0.457734294978, 0.311982220904, 0.21862482104, 0.209691492457,
                  0.206139918235, 0.204165156249, 0.20459212103, 0.206139918235,
                  0.206682542975, 0.206369839407, 0.203065233379, 0.201667213722,
                  0.201492885281, 0.200353138307, 0.200949384158, 0.199188574125,
                  0.200968259728, 0.199103402792)

# ALL-CANID RATES PLOT
plot(time_all, time_all, type="n", ylim=c(0, 1.8199229164), xaxt="n",
     xlim=c(-38.030586, -0.0), ylab="Rate", xlab="")
axis(1, labels=F)
polygon(c(time_all, rev(time_all)), c(maxHPD_sp_all, rev(minHPD_sp_all)), 
        col=alpha(viridis(4)[3], trans), border=NA)
polygon(c(time_all, rev(time_all)), c(maxHPD_ex_all, rev(minHPD_ex_all)),
        col=alpha(viridis(4)[1], trans), border=NA)
lines(time_all, rate_sp_all, col=viridis(4)[3], lwd=3)
lines(time_all, rate_ex_all, col=viridis(4)[1], lwd=3)

################################################################################
# Row 1, col 2. ALL-CANID ORIGINATION RATE SHIFTS
################################################################################

mids_sp_all = c(-0.513864162162, -1.54159248649, -2.56932081081, -3.59704913514,
                -4.62477745946, -5.65250578378, -6.68023410811, -7.70796243243,
                -8.73569075676, -9.76341908108, -10.7911474054, -11.8188757297,
                -12.8466040541, -13.8743323784, -14.9020607027, -15.929789027,
                -16.9575173514, -17.9852456757, -19.012974, -20.0407023243,
                -21.0684306486, -22.096158973, -23.1238872973, -24.1516156216,
                -25.1793439459, -26.2070722703, -27.2348005946, -28.2625289189,
                -29.2902572432, -30.3179855676, -31.3457138919, -32.3734422162,
                -33.4011705405, -34.4288988649, -35.4566271892, -36.4843555135,
                -37.5120838378)
counts_sp_all = c(0.00440375586854, 0.155707355243, 0.337857589984, 0.351636932707,
                  0.0919374021909, 0.0165743348983, 0.00656181533646, 
                  0.00493896713615, 0.00855086071987, 0.00639436619718, 
                  0.00430359937402, 0.0132300469484, 0.00392801251956, 
                  0.00630203442879, 0.020896713615, 0.0142472613459,
                  0.00831455399061, 0.0161924882629, 0.111461658842, 0.728815336463,
                  0.116651017214, 0.0116306729264, 0.0124084507042, 0.0126948356808,
                  0.0294272300469, 0.0363067292645, 0.0498716744914, 0.248388106416,
                  0.555976525822, 0.052607198748, 0.0100422535211, 0.0116463223787,
                  0.0104773082942, 0.00915492957746, 0.00950704225352, 
                  0.00943505477308, 0.00896870109546)
plot(mids_sp_all, counts_sp_all, type="h", xlim=c(-38.030586, -0.0), xaxt="n",
     ylim=c(0, 0.728815336463), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[3], xlab="")
axis(1, labels=F)
bf2_all = 0.0777911871815
bf6_all = 0.383967093567
abline(h=bf2_all, lty=2)
abline(h=bf6_all, lty=2)
mtext("A) all canids", side=3, line=1, cex=1.5)

################################################################################
# Row 1, col 3. ALL-CANID EXTINCTION RATE SHIFTS
################################################################################

mids_ex_all = c(-0.513864162162, -1.54159248649, -2.56932081081, -3.59704913514,
                -4.62477745946, -5.65250578378, -6.68023410811, -7.70796243243,
                -8.73569075676, -9.76341908108, -10.7911474054, -11.8188757297,
                -12.8466040541, -13.8743323784, -14.9020607027, -15.929789027,
                -16.9575173514, -17.9852456757, -19.012974, -20.0407023243,
                -21.0684306486, -22.096158973, -23.1238872973, -24.1516156216,
                -25.1793439459, -26.2070722703, -27.2348005946, -28.2625289189,
                -29.2902572432, -30.3179855676, -31.3457138919, -32.3734422162,
                -33.4011705405, -34.4288988649, -35.4566271892, -36.4843555135,
                -37.5120838378)
counts_ex_all = c(0.000840375586854, 0.0486040688576, 0.0578341158059,
                  0.0268701095462, 0.305992175274, 0.162272300469,
                  0.0470751173709, 0.0229014084507, 0.00856338028169,
                  0.0101533646322, 0.00588106416275, 0.00825039123631,
                  0.0113255086072, 0.00594835680751, 0.00921596244131,
                  0.0277042253521, 0.0788153364632, 0.0593208137715,
                  0.384571205008, 0.456211267606, 0.0833630672926,
                  0.0155070422535, 0.0105821596244, 0.00729107981221,
                  0.00506729264476, 0.00529577464789, 0.00847887323944,
                  0.0409718309859, 0.0206713615023, 0.0062676056338,
                  0.00449608763693, 0.00468857589984, 0.00595305164319,
                  0.00617214397496, 0.00643818466354, 0.00702034428795,
                  0.00666353677621)
plot(mids_ex_all, counts_ex_all, type="h", xlim=c(-38.030586, -0.0), xaxt="n",
     ylim=c(0, 0.728815336463), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[1], xlab="")
axis(1, labels=F)
abline(h=bf2_all, lty=2)
abline(h=bf6_all, lty=2)


################################################################################
# Row 2, col 1. HESPEROCYONINE DIVERSIFICATION RATES
################################################################################

time_hesp = c(-16.4222985, -18.1509615, -19.8796245, -21.6082875, -23.3369505,
              -25.0656135, -26.7942765, -28.5229395, -30.2516025, -31.9802655,
              -33.7089285, -35.4375915, -37.1662545)

# HESPEROCYONINE SPECIATION RATES
rate_sp_hesp = c(0.21333358699, 0.2128459514, 0.212194481485, 0.205028390505,
                 0.203122628507, 0.203499254107, 0.206964003123, 0.214747844667,
                 0.235499748144, 0.249176206577, 0.254597451316, 0.260810168686,
                 0.262522987973)
minHPD_sp_hesp = c(0.0370635674766, 0.0436633496667, 0.0458889773891, 0.0420025157596,
                   0.0409497856778, 0.0421493076524, 0.0482219022964, 0.0540788811471,
                   0.0884459916302, 0.120873430598, 0.122372785855, 0.120656165042,
                   0.119562416217)
maxHPD_sp_hesp = c(0.550523427103, 0.483423053743, 0.452321908479, 0.345790424474,
                   0.333449256545, 0.333449256545, 0.340179486454, 0.369262466195,
                   0.506248015099, 0.56359478581, 0.595694674046, 0.655831936059,
                   0.684778319145)

# HESPEROCYONINAE EXTINCTION RATES
rate_ex_hesp = c(0.456208850757, 0.401194404701, 0.301770710311, 0.23451747428,
                 0.220641980989, 0.216838315588, 0.211523621216, 0.208245227675,
                 0.184889081531, 0.176117981574, 0.173388645044, 0.17175078902,
                 0.170930931)
minHPD_ex_hesp = c(0.122197879496, 0.116323945608, 0.102875338147, 0.0855406473397,
                   0.0913020026561, 0.0948276839361, 0.0903617665616, 0.0867483787738,
                   0.0120362072566, 0.003661036512, 0.00243094502853, 0.00081821581844,
                   2.42160577403e-06)
maxHPD_ex_hesp = c(1.48300244681, 1.30426066543, 1.01433990058, 0.603146258853,
                   0.444184524577, 0.42028268256, 0.397561042691, 0.39286872618,
                   0.313907553781, 0.291235037081, 0.287655538536, 0.286064705444,
                   0.286949831932)

# HESPEROCYONINAE RATES PLOT
plot(time_hesp, time_hesp, type="n", ylim=c(0, 1.48300244681), xaxt="n",
     xlim=c(-38.030586, -0.0), ylab="Rate", xlab="")
axis(1, labels=F)
polygon(c(time_hesp, rev(time_hesp)), c(maxHPD_sp_hesp, rev(minHPD_sp_hesp)), 
        col=alpha(viridis(4)[3], trans), border=NA)
polygon(c(time_hesp, rev(time_hesp)), c(maxHPD_ex_hesp, rev(minHPD_ex_hesp)), 
        col=alpha(viridis(4)[1], trans), border=NA)
lines(time_hesp, rate_sp_hesp, col=viridis(4)[3], lwd=3)
lines(time_hesp, rate_ex_hesp, col=viridis(4)[1], lwd=3)

################################################################################
# Row 2, col 2. HESPEROCYONINE ORIGINATION RATE SHIFTS
################################################################################

mids_sp_hesp = c(-15.3933324286, -17.2043127143, -19.015293, -20.8262732857,
                 -22.6372535714, -24.4482338571, -26.2592141429, -28.0701944286,
                 -29.8811747143, -31.692155, -33.5031352857, -35.3141155714,
                 -37.1250958571)
counts_sp_hesp = c(0.0137909356725, 0.0289371345029, 0.0455365497076, 
                   0.0488976608187, 0.0158347953216, 0.023235380117, 0.0519590643275,
                   0.114717836257, 0.138245614035, 0.0376959064327,
                   0.0526301169591, 0.0298070175439, 0.0345160818713)
plot(mids_sp_hesp, counts_sp_hesp, type="h", xlim=c(-38.030586, -0.0), xaxt="n",
     ylim=c(0, 0.221383040936), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[3], xlab="")
axis(1, labels=F)
bf2_hesp = 0.119285105593
bf6_hesp = 0.500195628813
abline(h=bf2_hesp, lty=2)
abline(h=bf6_hesp, lty=2)

################################################################################
# Row 2, col 3. HESPEROCYONINE EXTINCTION RATE SHIFTS
################################################################################

mids_ex_hesp = c(-15.3933324286, -17.2043127143, -19.015293, -20.8262732857,
                 -22.6372535714, -24.4482338571, -26.2592141429, -28.0701944286,
                 -29.8811747143, -31.692155, -33.5031352857, -35.3141155714,
                 -37.1250958571)
counts_ex_hesp = c(0.0278304093567, 0.133730994152, 0.221383040936, 0.173209064327, 
                   0.0434239766082, 0.0440774853801, 0.0321944444444, 0.125046783626,
                   0.092701754386, 0.0304254385965, 0.0213815789474, 0.0186067251462, 
                   0.0180526315789)
plot(mids_ex_hesp, counts_ex_hesp, type="h", xlim=c(-38.025948, -0.0), xaxt="n", 
     ylim=c(0, 0.221383040936), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[1], xlab="")
axis(1, labels=F)
abline(h=bf2_hesp, lty=2)
abline(h=bf6_hesp, lty=2)


################################################################################
# Row 3, col 1. BOROPHAGINE DIVERSIFICATION RATES
################################################################################

time_boro = c(-2.688305, -3.763627, -4.838949, -5.914271, -6.989593, -8.064915,
              -9.140237, -10.215559, -11.290881, -12.366203, -13.441525, -14.516847,
              -15.592169, -16.667491, -17.742813, -18.818135, -19.893457, -20.968779,
              -22.044101, -23.119423, -24.194745, -25.270067, -26.345389, -27.420711,
              -28.496033, -29.571355, -30.646677, -31.721999, -32.797321)

# BOROPHAGINAE SPECIATION RATES
rate_sp_boro = c(0.268400686161, 0.268482253167, 0.268849121709, 0.269360424089,
                 0.269622406328, 0.269786982927, 0.270010726517, 0.269933727104,
                 0.270142514335, 0.271897552879, 0.275096012965, 0.276138633878,
                 0.27913374295, 0.288100027981, 0.28380219288, 0.282721470126,
                 0.279480450598, 0.263613794284, 0.25996230372, 0.259180705993,
                 0.259068789243, 0.258962395544, 0.259065518111, 0.259299098994,
                 0.260116192148, 0.263261723959, 0.268251625832, 0.273308319329,
                 0.285082106344)
minHPD_sp_boro = c(0.0977463970769, 0.109564905774, 0.116662154031, 0.127908996188,
                   0.131903914368, 0.134602529698, 0.13614439931, 0.133717504457,
                   0.133575251201, 0.139578530251, 0.150515726555, 0.151750979013,
                   0.148184206316, 0.166133888467, 0.162691904049, 0.160441786998,
                   0.111026824561, 0.068458557159, 0.0728629490215, 0.0750291110937,
                   0.0777032301527, 0.0781114195021, 0.0781841292634, 0.0779461214589,
                   0.0750959112521, 0.0588694760287, 0.066861311929, 0.0690623616239,
                   0.0765722525914)
maxHPD_sp_boro = c(0.418141842135, 0.408153370394, 0.398090179124, 0.395049102915,
                   0.393015053377, 0.393073695988, 0.393070453897, 0.392925478693,
                   0.39429859974, 0.405175043273, 0.427671678987, 0.44594936661,
                   0.52866819167, 0.933484033388, 0.687424256218, 0.661663930183,
                   0.622496590105, 0.375345898839, 0.360585273072, 0.358872728125,
                   0.357347474856, 0.357024588194, 0.35734717371, 0.358909292338,
                   0.363191772255, 0.415560440166, 0.622245443841, 0.80357920401,
                   1.30635983085)

# BOROPHAGINAE EXTINCTION RATES
rate_ex_boro = c(0.405816688859, 0.40508896594, 0.404494635841, 0.400787022153,
                 0.399309145855, 0.398245316273, 0.397905322612, 0.39770726799,
                 0.397476778693, 0.39773685762, 0.397862788429, 0.397622644524,
                 0.398112411072, 0.399815247605, 0.407986321492, 0.406030033553,
                 0.34666631105, 0.114704708546, 0.110837245304, 0.110619395531,
                 0.110688296919, 0.110708134338, 0.110850464105, 0.111055475129,
                 0.11113454876, 0.110695402202, 0.110581583475, 0.110615590124,
                 0.110865347733)
minHPD_ex_boro = c(0.228986709264, 0.231201263419, 0.232230789908, 0.264603965616,
                   0.271156247107, 0.274777724704, 0.27614837492, 0.275817348185,
                   0.276250255378, 0.276289125859, 0.276632808191, 0.274866188981,
                   0.274845316858, 0.269606145907, 0.237214858449, 0.102556785365,
                   0.0524716456599, 0.0411359175958, 0.0397329138356, 0.0443215710001,
                   0.0455044627687, 0.0460164169645, 0.0460991177272, 0.0468125396945,
                   0.0461099527346, 0.046144898, 0.0458042887372, 0.045949807274,
                   0.0444601412149)
maxHPD_ex_boro = c(0.784352810212, 0.704826846954, 0.638743376559, 0.548382051399,
                   0.534427212235, 0.528384596015, 0.526840442597, 0.524894278495,
                   0.524653534019, 0.523799423226, 0.524640880055, 0.525002045362,
                   0.527713758635, 0.537729142237, 0.724688106641, 0.673731965792,
                   0.511839208177, 0.386141408643, 0.209489268017, 0.197876534576,
                   0.194474585042, 0.193129576454, 0.192729475441, 0.193764685448,
                   0.193447885789, 0.193359466449, 0.193763347853, 0.195592741647,
                   0.199290027883)

# BOROPHAGINAE RATES PLOT
plot(time_boro, time_boro, type="n", ylim=c(0, 1.30635983085), xaxt="n", 
     xlim=c(-38.030586, -0.0), ylab="Rate", xlab="")
axis(1, labels=F)
polygon(c(time_boro, rev(time_boro)), c(maxHPD_sp_boro, rev(minHPD_sp_boro)), 
        col=alpha(viridis(4)[3], trans), border=NA)
polygon(c(time_boro, rev(time_boro)), c(maxHPD_ex_boro, rev(minHPD_ex_boro)), 
        col=alpha(viridis(4)[1], trans), border=NA)
lines(time_boro, rate_sp_boro, col=viridis(4)[3], lwd=3)
lines(time_boro, rate_ex_boro, col=viridis(4)[1], lwd=3)

################################################################################
# Row 3, col 2. BOROPHAGINAE ORIGINATION RATE SHIFTS
################################################################################

mids_sp_boro = c(-0.555583033333, -1.6667491, -2.77791516667, -3.88908123333,
                 -5.0002473, -6.11141336667, -7.22257943333, -8.3337455,
                 -9.44491156667, -10.5560776333, -11.6672437, -12.7784097667,
                 -13.8895758333, -15.0007419, -16.1119079667, -17.2230740333,
                 -18.3342401, -19.4454061667, -20.5565722333, -21.6677383,
                 -22.7789043667, -23.8900704333, -25.0012365, -26.1124025667,
                 -27.2235686333, -28.3347347, -29.4459007667, -30.5570668333,
                 -31.6682329, -32.7793989667)
counts_sp_boro = c(0.0, 0.00815242165242, 0.0138404558405, 0.0139074074074,
                   0.0126780626781, 0.00852136752137,0.00693732193732,
                   0.00703988603989, 0.0074886039886, 0.00830199430199,
                   0.0407991452991, 0.0147108262108, 0.0188732193732,
                   0.0893746438746, 0.0534515669516, 0.0377663817664,
                   0.0121737891738, 0.137259259259, 0.0699202279202,
                   0.0172464387464, 0.0101381766382, 0.00819230769231,
                   0.00794444444444, 0.00839316239316, 0.0116068376068,
                   0.0308789173789, 0.052047008547, 0.0548945868946,
                   0.105997150997, 0.167471509972)
plot(mids_sp_boro, counts_sp_boro, type="h", xlim=c(-38.030586, -0.0), xaxt="n", 
     ylim=c(0, 0.695810541311), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[3], xlab="")
axis(1, labels=F)
bf2_boro = 0.0920894521732
bf6_boro = 0.428399182181
abline(h=bf2_boro, lty=2)
abline(h=bf6_boro, lty=2)

################################################################################
# Row 3, col 3. BOROPHAGINAE EXTINCTION RATE SHIFTS
################################################################################

mids_ex_boro = c(-0.555583033333, -1.6667491, -2.77791516667, -3.88908123333,
                 -5.0002473, -6.11141336667, -7.22257943333, -8.3337455,
                 -9.44491156667, -10.5560776333, -11.6672437, -12.7784097667,
                 -13.8895758333, -15.0007419, -16.1119079667, -17.2230740333,
                 -18.3342401, -19.4454061667, -20.5565722333, -21.6677383,
                 -22.7789043667, -23.8900704333, -25.0012365, -26.1124025667,
                 -27.2235686333, -28.3347347, -29.4459007667, -30.5570668333,
                 -31.6682329, -32.7793989667)
counts_ex_boro = c(0.0, 0.0112806267806, 0.0163917378917, 0.0154943019943,
                   0.0381908831909, 0.0148874643875, 0.0122877492877,
                   0.00632478632479, 0.00613105413105, 0.00545868945869,
                   0.00672792022792, 0.00680341880342, 0.00611823361823,
                   0.00971367521368, 0.0380555555556, 0.0579829059829,
                   0.0795227920228, 0.695810541311, 0.182670940171,
                   0.0268461538462, 0.0103746438746, 0.00635754985755,
                   0.00540313390313, 0.0057207977208, 0.00506695156695,
                   0.00807692307692, 0.00510826210826, 0.0047962962963,
                   0.00813675213675, 0.0131780626781)
plot(mids_ex_boro, counts_ex_boro, type="h", xlim=c(-38.030586, -0.0), xaxt="n", 
     ylim=c(0, 0.695810541311), ylab="Frequency of rate shift", lwd=5, 
     col=viridis(4)[1], xlab="")
axis(1, labels=F)
abline(h=bf2_boro, lty=2)
abline(h=bf6_boro, lty=2)


################################################################################
# Row 4, col 1. CANINE DIVERSIFICATION RATES
################################################################################

time_cani = c(-0.514894607143, -1.54468382143, -2.57447303571, -3.60426225,
              -4.63405146429, -5.66384067857, -6.69362989286, -7.72341910714,
              -8.75320832143, -9.78299753571, -10.81278675, -11.8425759643,
              -12.8723651786, -13.9021543929, -14.9319436071, -15.9617328214,
              -16.9915220357, -18.02131125, -19.0511004643, -20.0808896786,
              -21.1106788929, -22.1404681071, -23.1702573214, -24.2000465357,
              -25.22983575, -26.2596249643, -27.2894141786, -28.3192033929)

# CANINAE SPECIATION RATES
rate_sp_cani = c(1.05500240328, 1.05319382861, 1.00441666833, 0.831951773891,
                 0.516733706107, 0.425983692518, 0.411624783534, 0.407589089056,
                 0.400786530264, 0.376555944853, 0.361274091231, 0.356413392435,
                 0.352291731834, 0.336439080052, 0.328949109328, 0.325139987625,
                 0.320275782024, 0.316902652387, 0.314973143779, 0.312912699549,
                 0.311360525588, 0.310579963673, 0.310439647141, 0.310936646449,
                 0.312659829254, 0.316177147519, 0.321853164604, 0.327827188984)
minHPD_sp_cani = c(0.418120947129, 0.413349226603, 0.303102884673, 0.201788282603,
                   0.164412240941, 0.175644965242, 0.178462274772, 0.180207790774,
                   0.177160832269, 0.152062744493, 0.137441009997, 0.134840172299,
                   0.130707490046, 0.0918454001672, 0.0808616044223, 0.0793394971257,
                   0.0749825297621, 0.0745048433054, 0.07047321334, 0.0714221029201,
                   0.0694192126638, 0.0660300429788, 0.0649876977208, 0.0659854650624,
                   0.0660043535371, 0.0660043535371, 0.0650042116017, 0.0680030300583)
maxHPD_sp_cani = c(1.91027645141, 1.90619104339, 1.79593141163, 1.64196075046,
                   1.30961342221, 1.03963172831, 0.976989620696, 0.96394996788,
                   0.949311049034, 0.871336239465, 0.801925434588, 0.782964240549,
                   0.769837613929, 0.684745287804, 0.634870496478, 0.613192095018,
                   0.58699764203, 0.572386432423, 0.56086518678, 0.557572814471,
                   0.553381889157, 0.54930807508, 0.549162996988, 0.553477437625,
                   0.564196315845, 0.591924709501, 0.656763847393, 0.773847162467)

# CANINAE EXTINCTION RATES
rate_ex_cani = c(0.665528041332, 0.665227955949, 0.648406308956, 0.617734564956,
                 0.607030708262, 0.559654650452, 0.521261921357, 0.486771187663,
                 0.44302802177, 0.412752103903, 0.334227665585, 0.30292323776,
                 0.288903126035, 0.268018299793, 0.255059750094, 0.249309943951,
                 0.246268485098, 0.243749929598, 0.240267388406, 0.237471520339,
                 0.234723019477, 0.232841399988, 0.231709964574, 0.23101880135,
                 0.230539628125, 0.230262609386, 0.230297260413, 0.230509608921)
minHPD_ex_cani = c(0.30165642442, 0.302504273071, 0.27114244126, 0.219609273839,
                   0.207042770075, 0.171810589875, 0.162798955529, 0.148420953986,
                   0.132833186749, 0.122863018422, 0.0930393155603, 0.0857945862943,
                   0.0827313545891, 0.0732262825262, 0.0688592247424, 0.0686396522421,
                   0.0686503788336, 0.0685531224301, 0.068722529939, 0.068863673443,
                   0.0642331900798, 0.0622527665492, 0.0644857886031, 0.0622605771584,
                   0.0622533569108, 0.0616080215417, 0.0582482573435, 0.0568048358666)
maxHPD_ex_cani = c(1.21198687642, 1.21217731631, 1.17587029085, 1.09350976902,
                   1.07252767289, 0.964163059767, 0.90316508759, 0.869094207772,
                   0.831491492564, 0.81129396651, 0.727579463682, 0.679607338895,
                   0.65612802932, 0.603293772302, 0.557082067272, 0.534606376288,
                   0.522114977333, 0.510992268086, 0.497651532763, 0.488378255054,
                   0.474980990805, 0.467476402312, 0.467087758203, 0.464086500567,
                   0.464737651816, 0.466452914809, 0.467259613444, 0.472882580926)

# CANINAE RATES PLOT
plot(time_cani, time_cani, type="n", ylim=c(0, 1.91027645141), ylab="Rate", 
     xlim=c(-38.030586, -0.0), xlab="Time (millions of years)")
polygon(c(time_cani, rev(time_cani)), c(maxHPD_sp_cani, rev(minHPD_sp_cani)), 
        col=alpha(viridis(4)[3], trans), border=NA)
polygon(c(time_cani, rev(time_cani)), c(maxHPD_ex_cani, rev(minHPD_ex_cani)), 
        col=alpha(viridis(4)[1], trans), border=NA)
lines(time_cani, rate_sp_cani, col=viridis(4)[3], lwd=3)
lines(time_cani, rate_ex_cani, col=viridis(4)[1], lwd=3)

################################################################################
# Row 4, col 2. CANINE ORIGINATION RATE SHIFTS
################################################################################

mids_sp_cani = c(-0.533964777778, -1.60189433333, -2.66982388889, -3.73775344444,
                 -4.805683, -5.87361255556, -6.94154211111, -8.00947166667,
                 -9.07740122222, -10.1453307778, -11.2132603333, -12.2811898889,
                 -13.3491194444, -14.417049, -15.4849785556, -16.5529081111,
                 -17.6208376667, -18.6887672222, -19.7566967778, -20.8246263333,
                 -21.8925558889, -22.9604854444, -24.028415, -25.0963445556,
                 -26.1642741111, -27.2322036667, -28.3001332222)
counts_sp_cani = c(0.00524, 0.0642022222222, 0.22333, 0.27712, 0.117994444444,
                   0.0434366666667, 0.0204577777778, 0.0386044444444,
                   0.0913111111111, 0.0438722222222, 0.0225211111111, 0.04876,
                   0.05952, 0.0279133333333, 0.0264722222222, 0.0251488888889,
                   0.0172633333333, 0.0153344444444, 0.0152444444444,
                   0.0112766666667, 0.00936333333333, 0.00975, 0.0136677777778,
                   0.0216566666667, 0.0313933333333, 0.0338022222222,
                   0.0343155555556)
plot(mids_sp_cani, counts_sp_cani, type="h", xlim=c(-38.030586, -0.0), 
     ylim=c(0, 0.27712), ylab="Frequency of rate shift", lwd=5, col=viridis(4)[3],
     xlab="Time (millions of years)")
bf2_cani = 0.0999400428108
bf6_cani = 0.450688083203
abline(h=bf2_cani, lty=2)
abline(h=bf6_cani, lty=2)

################################################################################
# Row 4, col 3. CANINE EXTINCTION RATE SHIFTS
################################################################################

mids_ex_cani = c(-0.533964777778, -1.60189433333, -2.66982388889, -3.73775344444,
                 -4.805683, -5.87361255556, -6.94154211111, -8.00947166667,
                 -9.07740122222, -10.1453307778, -11.2132603333, -12.2811898889,
                 -13.3491194444, -14.417049, -15.4849785556, -16.5529081111,
                 -17.6208376667, -18.6887672222, -19.7566967778, -20.8246263333,
                 -21.8925558889, -22.9604854444, -24.028415, -25.0963445556,
                 -26.1642741111, -27.2322036667, -28.3001332222)
counts_ex_cani = c(0.00188555555556, 0.0473144444444, 0.0681122222222,
                   0.0306666666667, 0.127103333333, 0.05801, 0.0903877777778,
                   0.0652211111111, 0.0836, 0.137074444444, 0.0612944444444,
                   0.0539755555556, 0.0734311111111, 0.0402033333333,
                   0.0235211111111, 0.01841, 0.0211577777778, 0.0189266666667,
                   0.0191288888889, 0.01599, 0.0123322222222, 0.0107833333333,
                   0.0112155555556, 0.0114, 0.0115, 0.01259, 0.0134244444444)
plot(mids_ex_cani, counts_ex_cani, type="h", xlim=c(-38.030586, -0.0), 
     ylim=c(0, 0.27712), ylab="Frequency of rate shift",  lwd=5, col=viridis(4)[1],
     xlab="Time (millions of years)")
abline(h=bf2_cani, lty=2)
abline(h=bf6_cani, lty=2)


################################################################################
# LEGEND
################################################################################

legend(-40, 0.25, c("origination", "extinction"), lwd=3, x.intersp=0.25,
       col=viridis(4)[c(3, 1)], bty="n", cex=2, y.intersp=0.5)

mtext("Time (millions of years ago)", side=1, line=3, outer=TRUE, cex=1.25)